<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>加密的HTML文件</title>
    <style>
        body { 
            margin: 0; 
            padding: 0; 
            font-family: Arial, sans-serif;
            background: #f5f5f5;
        }
        .decrypt-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .decrypt-box {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 10px;
            padding: 30px;
            max-width: 500px;
            width: 100%;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        .decrypt-box h2 {
            margin-bottom: 20px;
        }
        .decrypt-box p {
            margin-bottom: 20px;
            opacity: 0.9;
        }
        .decrypt-input {
            width: 100%;
            padding: 12px;
            margin: 10px 0 20px;
            border: none;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.9);
            font-size: 16px;
        }
        .decrypt-btn {
            padding: 12px 30px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s;
        }
        .decrypt-btn:hover {
            background: #45a049;
        }
        .hidden {
            display: none !important;
        }
        #contentContainer {
            all: initial !important;
        }
        .domain-warning {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #c62828;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 999999;
            text-align: center;
            padding: 20px;
            font-family: Arial, sans-serif;
        }
        .domain-warning h1 {
            font-size: 2.5rem;
            margin-bottom: 20px;
            color: #ffcdd2;
        }
        .domain-warning p {
            font-size: 1.2rem;
            margin-bottom: 10px;
            max-width: 800px;
        }
        .domain-warning .current-domain {
            color: #ffcdd2;
            font-weight: bold;
            background: rgba(0,0,0,0.3);
            padding: 5px 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .domain-warning .allowed-domain {
            color: #c8e6c9;
            font-weight: bold;
            background: rgba(0,0,0,0.3);
            padding: 5px 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .debug-info {
            font-size: 0.9rem;
            background: rgba(0,0,0,0.5);
            padding: 10px;
            border-radius: 5px;
            margin-top: 20px;
            text-align: left;
            max-width: 800px;
        }
    </style>
</head>
<body>
    <div id="domainWarning" class="domain-warning hidden">
        <h1>盗版警告！</h1>
        <p>此HTML文件只能在指定的授权域名下运行。</p>
        <p>当前域名：<span id="currentDomainDisplay" class="current-domain"></span></p>
        <p>授权域名：<span id="allowedDomainDisplay" class="allowed-domain"></span></p>
        <div id="debugInfo" class="debug-info"></div>
        <p style="margin-top: 30px; font-size: 1rem; opacity: 0.8;">如需正常使用，请联系文件作者获取授权版本。</p>
    </div>

    <div id="decryptPrompt" class="decrypt-container">
        <div class="decrypt-box">
            <h2>需要密码查看源代码</h2>
            <p>此HTML文件已加密。要查看源代码，请输入密码：</p>
            <input type="password" id="decryptPassword" class="decrypt-input" placeholder="输入密码">
            <button id="showSourceBtn" class="decrypt-btn">显示源代码</button>
            <p style="font-size: 14px; margin-top: 20px; opacity: 0.7;">注意：此页面内容可以正常浏览，无需密码。</p>
        </div>
    </div>

    <div id="contentContainer" class="hidden"></div>

    <script>
        // 域名验证和加密的数据
        const allowedDomainKey = 1280;
        const allowedDomain = "gz.whx11258.xyz";
        const encryptedData = "yaTJuMieyJTIn8iJyIfIj8ilyYHIisiXyInIicmYya3JlMiByJ7IhsiAyZPJpMmTyJjIlMiTyJfJism/yYrImsidyI3Im8mbyJ/IlcifyI3Ls8uky7bKvsqmy7DLssuhyqXKscqoyrXKrMqHyrLLu8u5y6XLvsu2yqrLgsuey4/KqcqoyqjKrsqkyqHKscury4nLlcuOy4bKmsqFyqzKm8uby53Lk8uHy4nKk8qkyoHLlsuey53Lh8uRy4fKlsuMyrLKmcqay5nLncuey5XLmMqyyq7Kt8qtyqDLqMqlyqjKpMqmyrjLscusy67KiMu+ypbLoMqUy6LLr8ufy7bLt8qsyrzKosqvy7HKvMqyyrbKh8qPy5jLg8qHyoDKiMqTyo3Km8uRy6HLjMuNyp7KjsqUypXKm8qdypPLj8uWy4bLiMqJyoLLgMu2yoDLtMuRzajNpM2jzafNoc23zIzNvMyCzIDNp82izaLMoM2mzarNuc22zbrNp8yuzKfMps2nzaDMosyQzJLNvs28zb3NtM2HzZPNjc2WzYrNgcyLzYTNh82FzYXNmcyWzZ/Nic2NzJjMhcyHzJ/MlMyEzIXMhsyUzJnMi8yDzIXMlMyezITNis2hzaLNo82kzLHMo8y/zLzNpMyrzKfMpcyqzKDNtc2wzLLMt8y9zKDMsMykzazJksm5ybrJu8mWyb3Jvsm/yarJq8ifyanJisiNyIPIhsiMyIzImMmayabIlsmkyabInciYyJzJnsicyJDIn8iQyJDIjcmAyYPJiMmNyI7Ih8q7yovKi8uhy6XLpsuty6DLusumy7/LpcuoyqDLrcugy7zLvsugyqnLpsuyy7TKv8qpyqvKqMq3yrzKrMqryqvKjMqBypPKlMqRyozKhsqcyqLKicqKyovKjMuZy4vLl8uEypzLk8ufy53LksuYyo3KmMuay5/LlcuIy5jLjMqEy4rLocuiy6PLpMqyyqnKtcqsy6TKucq7yq3KrsqnyqHKt8ury7LLocukyqXKrsusy5LLucu6y7vLvMqxyrfKscqFy4zKisqGyo3KgsqOypPLksuJy5/Lm8ucyp3KlsuUy7rLu8qPy7nLmsqdypPKlsqcypzKiMubyo/KicqMypDNrs2mzbnMicykzKXMpsynzavNps2mzaTNvsy3zK7MrM22zKPNtMyhzbLMp8ytzJ3NpcyTzLTNr82zza3NsM2+zZbMgc2ZzKnMhMyFzYnNkc2NzZvNjM2HzYPNmsyUzI/NmM2YzZbNl82RzZvMjcy9zJjMmc2YzZrNn82WzZnNjcyvzLTMrMynzanMpsypzKvMp8y7zbDNq8y+zKrMrM2nzaTNpM2+zbPNpc2mzafNu8m4yajJosmiybXJpsmUyKLJqsmByajJqcmKyJHIiciXyIbIiMicyYvIjcmNyJXJpcmQyZHIlMifyJvIlMiCyY3JmMiVyJ/InciIyYbJtMmfyqDLpcury7DLtMupy6fLvsqyyqnLqMuny6PLrsulyrTKmsqxyrLLsMu7y7nLuculyqLKucq5y73Krsu7yqzLucqSyprKqMqDyoTLkcuDy5/LnMqEy4vLh8uFy4rLgMqVypDLksuXy53LgMuQy4TKjMqyypnKmsuLy53Lmcuay5bKrsqmy7jLo8u1y7HKtsq/y6jLuMu8yrvKtMu2y4TLr8uwyqXKt8qryqDLuMqyyrLKu8q2yqjKusqoyrTKscqxy5rLgcqMyozKisqAy53LrcqVy6PLisuhy6bLg8qayoDKgMqfypPKhcuUypTLjMqfypfKj8qfyonLnMqGy7TLn8ygzaPNo82gza/Nos20zajNvc2nza7Mps2vzaLNos2gzaLMq8yyzLDNsM2xzbLMrMySzLnMus24zbPNsc2xza3MmsyBzYDNj82FzYbNjcyczKLNlMygzKHMkMyCzZ3Nm82JzZ3Nl8yNzL7MicyZzZ/Nnc2YzZ7Mhcy2zLfMgs2dzK/Mpcy7zb3Njs25zKLMrsy+zanMqcynzK3Mvsy9zbLNssy5zLfMssywzLDMpM21yabJk8m6yafIr8ipyKzIsMiOyIbJnMiUyIzIncmXyZbJmsmcyZLJl8mDyJ7ImsidyJ/In8iVyY3JvsmVyZbJl8mYybPJhsmUyJjIlMiIyYHKisq9y6bLqsuyyqXLpcury6nLusu5yrbKrsu5y6HLv8u+y7DLpMqxyqrKn8q2yrfKpMu4yrrLs8uuy7jLuMqiyoLLicuWy5fLlMqfyonKiMufy4HLksqayp3Kn8qbypfKnsuJy4vLicqWyovkso3pq4Lpl5rKhcqVy5rKgsq3yp7Kn8u8yqDLosqryrbKoMqgy7rLqsqhyr7Kv8q8y7fLocugyrfKq8u8yqTKvMqty6fLpsuqy6zLosu1yqTKpMqky7DKgcqIy5TLjcqDyozKksqPyp3Ki8uEyoLKg8uCy4zLkeWGquWlk8uOy5zKlcuLy7zLl8uYy4XKm8ubypTKj8qbypnMvcyjzarNt82wzbXMvMyozKfNrs2wzKXNu82lzbbMvsyhzKPMp8yrzLrNrc2vza3Mt82uzbXNqc23zLPNuc22zZTNic2XzYHMis2MzYnMiMyKzJfktKHosZbnp7XMkcyBzY7Mjsy7zI7MnM2QzZzNgMyJzLLMhc2ezZLNisydzZ3Nk8yhzLLMsc2+zabMrcyjzKbMrMyszLjNus2uzbPNhM2vzazMosymzKHMu8y7zLHNqei2geaRtuaBi+eTn+SxtuSzp+e0j+eihu+1rOaLieWGjeSyhuWVjOi2vOmOquaAmeWBmOaBuOeTruWEseWnjuOJrOmol+eSgeWbvOiIpee6ieS2kuaIm+OJt8mKyZjIi8iNyIjIlMiSyJrJgMm1yrzKrsumy6rLssq7yozKu8usy6DLvMqry6/Locuvy7zLo8qsyrDLtcu7y7rLosuyy6rKu8qkypHKvMq9yqLLr8qey6LLjcuTy53Ll8uPy4DLgMudyorIgsqMyp/KnsqdyoTKkcuFy5vLjMqEyofKhcqNyoHKlMuDy4XLh8qey77KrMqty6LKkcqtyqLKrsqzyrvLqcqYyq7Kv8qoyrzKucq1yrXLrsu8yqTLq8ucy6vLt8q9yrPKrcuiy5fLosuwyoLKjsqGyprLmsuvy5rLiMqAyp3Kh8qHy5I=";
        const passwordKey = 600;
        
        // 域名验证函数
        function validateDomain() {
            try {
                // 获取当前域名（不包含端口和协议）
                let currentDomain = window.location.hostname.toLowerCase();
                
                // 移除www.前缀进行统一比较
                currentDomain = currentDomain.replace(/^www\./, '');
                let allowedDomainClean = allowedDomain.toLowerCase().replace(/^www\./, '');
                
                // 调试信息
                let debugHtml = '<strong>调试信息：</strong><br>';
                debugHtml += '原始当前域名: ' + window.location.hostname + '<br>';
                debugHtml += '处理后的当前域名: ' + currentDomain + '<br>';
                debugHtml += '原始授权域名: ' + allowedDomain + '<br>';
                debugHtml += '处理后的授权域名: ' + allowedDomainClean + '<br>';
                debugHtml += '当前域名密钥: ' + Array.from(currentDomain).reduce((sum, char) => sum + char.charCodeAt(0), 0) + '<br>';
                debugHtml += '授权域名密钥: ' + allowedDomainKey + '<br>';
                
                // 计算当前域名的密钥
                const currentDomainKey = Array.from(currentDomain).reduce((sum, char) => sum + char.charCodeAt(0), 0);
                
                debugHtml += '密钥匹配: ' + (currentDomainKey === allowedDomainKey ? '是' : '否') + '<br>';
                debugHtml += '直接域名匹配: ' + (currentDomain === allowedDomainClean ? '是' : '否') + '<br>';
                
                // 验证域名
                if (currentDomainKey === allowedDomainKey) {
                    // 密钥匹配，允许访问
                    document.getElementById('debugInfo').innerHTML = debugHtml + '<br><span style="color: green;">验证成功！</span>';
                    return true;
                } else {
                    // 显示调试信息
                    document.getElementById('debugInfo').innerHTML = debugHtml + '<br><span style="color: red;">验证失败！</span>';
                    
                    // 也尝试直接比较域名（作为备用验证）
                    if (currentDomain === allowedDomainClean) {
                        document.getElementById('debugInfo').innerHTML += '<br><span style="color: green;">直接域名匹配成功！</span>';
                        return true;
                    }
                    
                    showDomainWarning(currentDomain, allowedDomainClean);
                    return false;
                }
            } catch (e) {
                console.error('域名验证失败:', e);
                document.getElementById('debugInfo').innerHTML = '验证异常: ' + e.message;
                return false;
            }
        }
        
        // 显示域名警告
        function showDomainWarning(current, allowed) {
            const warning = document.getElementById('domainWarning');
            const currentDisplay = document.getElementById('currentDomainDisplay');
            const allowedDisplay = document.getElementById('allowedDomainDisplay');
            
            if (warning && currentDisplay && allowedDisplay) {
                currentDisplay.textContent = current;
                allowedDisplay.textContent = allowed;
                warning.classList.remove('hidden');
                
                // 隐藏其他所有内容
                document.getElementById('decryptPrompt')?.classList.add('hidden');
                document.getElementById('contentContainer')?.classList.add('hidden');
            }
        }
        
        // 支持Unicode的Base64解码函数
        function decodeBase64(base64) {
            try {
                // 将Base64解码为二进制字符串
                const binaryString = atob(base64);
                
                // 将二进制字符串转换为字节数组
                const bytes = new Uint8Array(binaryString.length);
                for (let i = 0; i < binaryString.length; i++) {
                    bytes[i] = binaryString.charCodeAt(i);
                }
                
                // 将UTF-8字节数组解码为字符串
                return new TextDecoder().decode(bytes);
            } catch (e) {
                console.error('Base64解码失败:', e);
                return "";
            }
        }
        
        // 解密函数
        function decryptHTML(encryptedData, key) {
            try {
                // 从base64解码
                const decodedData = decodeBase64(encryptedData);
                if (!decodedData) {
                    return "<p style='color: red;'>解密失败：数据损坏</p>";
                }
                
                // 解密字符
                const decryptedChars = [];
                for (let i = 0; i < decodedData.length; i++) {
                    const charCode = decodedData.charCodeAt(i);
                    // 使用相同的XOR解密
                    const decryptedCode = charCode ^ (key + i % 256);
                    decryptedChars.push(String.fromCharCode(decryptedCode));
                }
                
                return decryptedChars.join('');
            } catch (e) {
                console.error('解密失败:', e);
                return "<p style='color: red;'>解密失败。请检查密码是否正确。</p>";
            }
        }
        
        // 显示原始HTML内容 - 使用document.write完全替换当前文档
        function showOriginalContent() {
            try {
                // 先验证域名
                if (!validateDomain()) {
                    return;
                }
                
                const decryptedHTML = decryptHTML(encryptedData, passwordKey);
                
                // 使用document.write完全替换当前文档
                document.open();
                document.write(decryptedHTML);
                document.close();
            } catch (e) {
                console.error('显示内容失败:', e);
                alert('显示内容失败，请检查密码是否正确');
            }
        }
        
        // 显示源代码
        function showSourceCode(password) {
            try {
                const userKey = Array.from(password).reduce((sum, char) => sum + char.charCodeAt(0), 0);
                
                if (userKey === passwordKey) {
                    const decryptedHTML = decryptHTML(encryptedData, passwordKey);
                    
                    // 创建新窗口显示源代码
                    const sourceWindow = window.open();
                    if (!sourceWindow) {
                        alert('弹出窗口被阻止，请允许弹出窗口后重试');
                        return;
                    }
                    
                    sourceWindow.document.write(
                        '<!DOCTYPE html><html><head><title>HTML源代码</title>' +
                        '<style>body { font-family: monospace; background: #f5f5f5; padding: 20px; } pre { background: white; padding: 20px; border-radius: 5px; overflow: auto; }</style></head>' +
                        '<body><h2>HTML源代码</h2><pre>' + 
                        decryptedHTML
                            .replace(/&/g, '&amp;')
                            .replace(/</g, '&lt;')
                            .replace(/>/g, '&gt;')
                            .replace(/"/g, '&quot;')
                            .replace(/'/g, '&#039;') + 
                        '</pre></body></html>'
                    );
                    sourceWindow.document.close();
                } else {
                    alert('密码错误！');
                }
            } catch (e) {
                console.error('显示源代码失败:', e);
                alert('显示源代码失败');
            }
        }
        
        // 页面加载时自动显示原始内容
        window.addEventListener('DOMContentLoaded', function() {
            showOriginalContent();
        });
        
        // 设置查看源代码按钮事件
        document.addEventListener('DOMContentLoaded', function() {
            // 由于document.write会替换整个文档，我们需要重新获取元素
            setTimeout(function() {
                const sourceBtn = document.getElementById('showSourceBtn');
                const passwordInput = document.getElementById('decryptPassword');
                
                if (sourceBtn && passwordInput) {
                    sourceBtn.addEventListener('click', function() {
                        const password = passwordInput.value;
                        if (password) {
                            showSourceCode(password);
                        } else {
                            alert('请输入密码');
                        }
                    });
                    
                    // 允许按Enter键提交密码
                    passwordInput.addEventListener('keyup', function(event) {
                        if (event.key === 'Enter') {
                            sourceBtn.click();
                        }
                    });
                }
            }, 100);
        });
    </script>
</body>
</html>
